; This is for catch SMS and USSD
; also for fixing CALLERID(name) from DONGLENAME to CALLERID(number)

[ext-did-custom]
exten => sms,1,Verbose(Incoming SMS from ${CALLERID(num)} ${BASE64_DECODE(${SMS_BASE64})})
exten => sms,n,System(echo '${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)} - ${DONGLENAME} - ${CALLERID(num)}: ${BASE64_DECODE(${SMS_BASE64})}' >> /var/log/asterisk/sms.txt)
exten => sms,n,System(echo '${SMS_BASE64}' | /var/lib/asterisk/bin/sms-send.sh ${CALLERID(num)} ${DONGLENAME})
exten => sms,n,Hangup()

exten => ussd,1,Verbose(Incoming USSD: ${BASE64_DECODE(${USSD_BASE64})})
exten => ussd,n,System(echo '${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)} - ${DONGLENAME}: ${BASE64_DECODE(${USSD_BASE64})}' >> /var/log/asterisk/ussd.txt)
exten => ussd,n,Hangup()

exten => s,1,Noop(CALLERID(name)=${CALLERID(name)} CALLERID(num)=${CALLERID(num)})
exten => s,n,Set(CALLERID(name)=${CALLERID(num)})